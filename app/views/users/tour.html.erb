<%= render 'layouts/sidebar' %>
<div class="page-content" id="dashboard">
  <div class="container-fluid">    
  <h1 class="page-heading" id="page-heading">Customer Relationship Manager </h1>
    <div class="row">
      <div class="col-sm-3">
        <div class="the-box no-border bg-info tiles-information" id="nactivities">
          <div class="tiles-inner text-center">
            <p>Atividades</p>
            <h1 class="bolded"><%= @nactivities %></h1> 
            <div class="progress no-rounded progress-xs">
              <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
              </div><!-- /.progress-bar .progress-bar-success -->
            </div><!-- /.progress .no-rounded -->
          </div><!-- /.tiles-inner -->
        </div><!-- /.the-box no-border -->
      </div><!-- /.col-sm-3 -->

      <div class="col-sm-3">
        <div class="the-box no-border bg-primary tiles-information" id="nclients">
          <div class="tiles-inner text-center">
            <p>Clientes</p>
            <h1 class="bolded"><%= @nclients %></h1> 
            <div class="progress no-rounded progress-xs">
              <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
              </div><!-- /.progress-bar .progress-bar-primary -->
            </div><!-- /.progress .no-rounded -->
          </div><!-- /.tiles-inner -->
        </div><!-- /.the-box no-border -->
      </div><!-- /.col-sm-3 -->

      <div class="col-sm-3">
        <div class="the-box no-border bg-danger tiles-information" id="nprojects">
          <div class="tiles-inner text-center">
            <p>Projetos</p>
            <h1 class="bolded"><%= @nprojects %></h1> 
            <div class="progress no-rounded progress-xs">
              <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
              </div><!-- /.progress-bar .progress-bar-danger -->
            </div><!-- /.progress .no-rounded -->
          </div><!-- /.tiles-inner -->
        </div><!-- /.the-box no-border -->
      </div><!-- /.col-sm-3 -->

      <div class="col-sm-3">
        <div class="the-box no-border bg-warning tiles-information" id="nemails">
          <div class="tiles-inner text-center">
            <p>E-mails</p>
            <h1 class="bolded"><%= @nemails %></h1> 
            <div class="progress no-rounded progress-xs">
              <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
              </div><!-- /.progress-bar .progress-bar-warning -->
            </div><!-- /.progress .no-rounded -->
          </div><!-- /.tiles-inner -->
        </div><!-- /.the-box no-border -->
      </div><!-- /.col-sm-3 -->
    </div>

    <div class="col-sm-6">
      <div class="panel panel-primary" id="lastclients">
        <div class="panel-heading">
        <h3 class="panel-title">
          <a class="block-collapse collapsed" data-toggle="collapse" href="#panel-collapse-1">
          Clientes - Ultimos
          <span class="right-content">
            <span class="right-icon"><i class="glyphicon glyphicon-plus icon-collapse"></i></span>
          </span>
          </a>
        </h3>
        </div>
        <div id="panel-collapse-1" class="collapse" style="height: auto;">
          <% @contacts.each do |c|  %>
            <div class="panel-body">
              <%= link_to c.name, c.client %>
            </div>
          <% end %>
        </div><!-- /.collapse in -->          
      </div><!-- /.panel panel-primary -->
    </div>

    <div class="col-sm-6">
      <div class="panel panel-warning" id="lastemails">
        <div class="panel-heading">
        <h3 class="panel-title">
          <a class="block-collapse collapsed" data-toggle="collapse" href="#panel-collapse-2">
          E-mails - Ultimos
          <span class="right-content">
            <span class="right-icon"><i class="glyphicon glyphicon-plus icon-collapse"></i></span>
          </span>
          </a>
        </h3>
        </div>
        <div id="panel-collapse-2" class="collapse" style="height: auto;">
          <% @emails.each do |e|  %>
            <div class="panel-body">
              <%= link_to "#{e.subject} - #{e.sender}", e %>
            </div>
          <% end %>
        </div><!-- /.collapse in -->
      </div><!-- /.panel panel-warning -->
    </div>

    <div class="col-sm-6">
      <div class="panel panel-danger" id="lastprojects">
        <div class="panel-heading">
        <h3 class="panel-title">
          <a class="block-collapse collapsed" data-toggle="collapse" href="#panel-collapse-3">
          Projetos
          <span class="right-content">
            <span class="right-icon"><i class="glyphicon glyphicon-plus icon-collapse"></i></span>
          </span>
          </a>
        </h3>
        </div>
        <div id="panel-collapse-3" class="collapse" style="height: auto;">
          <% @projects.each do |p|  %>
            <div class="panel-body">
              <%= link_to "#{p.title} - #{p.client.name}", p %>
            </div>
          <% end %>
        </div><!-- /.collapse in -->
      </div><!-- /.panel panel-warning -->
    </div>

    <div class="col-sm-6">
      <div class="panel panel-info" id="lastactivities">
        <div class="panel-heading">
        <h3 class="panel-title">
          <a class="block-collapse collapsed" data-toggle="collapse" href="#panel-collapse-4">
          Tarefas
          <span class="right-content">
            <span class="right-icon"><i class="glyphicon glyphicon-plus icon-collapse"></i></span>
          </span>
          </a>
        </h3>
        </div>
        <div id="panel-collapse-4" class="collapse" style="height: auto;">
          <% @activities.each do |a|  %>
            <div class="panel-body">
              <%= link_to "#{a.name} - #{a.project.title}", a %>
            </div>
          <% end %>
        </div><!-- /.collapse in -->
      </div><!-- /.panel panel-warning -->
    </div>

    <div class="row">  
      <div class="col-sm-6" id="activitiescalendar">
        <div class="the-box text-center">
          <h2 class="light">Calendário - CRM</h2>
        </div>
        <div id='calendar'></div>
      </div>

      <div class="col-sm-6" id="gmailcalendar">
        <div class="the-box text-center">
          <h2 class="light">Google Calendar</h2>
        </div>
        <div id='calendar2'></div>
      </div>  
    </div> 
  </div>
</div>

<div class="page-content">
  <%= render 'layouts/footer' %>
</div>

<script>
  $('#calendar').fullCalendar({
    editable: false,
    weekMode: 'fixed',
    events: [
      <% @activities.each do |a| %>   
        {
          title: "<%= a.name %>",

          start: new Date( "<%= a.date_limit.year %>", "<%= a.date_limit.month - 1 %>", "<%= a.date_limit.day%>"),

          allDay: true,

          url: '<%= "/activities/#{a.id}"%>'
        },
      <% end %>
    ]
  })

  $('#calendar2').fullCalendar({
    events: 'https://www.google.com/calendar/feeds/gui.carneiro15%40gmail.com/public/basic'
  })  
</script>
<script>
var tour = new Tour({ backdrop: true,
  onShown: function(tour) {
    var stepElement = getTourElement(tour);
    $(stepElement).after($('.tour-step-background'));
    $(stepElement).after($('.tour-backdrop'));
  },
  steps: [
  {
      element: "#page-heading",
      title: "Inicio",
      placement: "bottom",
      content: "Bem vindo ao tour =)"
    },
    {
      element: "#page-heading",
      title: "Inicio",
      placement: "bottom",
      content: "Irei lhe explicar como o CRM funciona"
    },    
    {
      element: "#page-heading",
      title: "Inicio",
      placement: "bottom",
      content: "Fique atento, mas qualquer coisa há um botão para retornar ao Tour =)"
    },        
    {
      element: "#dashboard",
      title: "Inicio",
      placement: "top",
      content: "Vamos inicar explicando a Dashboard, nela você encontrará informações gerais"
    },
    {
      element: "#nactivities",
      title: "Atividades",
      content: "Esse é um contatos para todos as Atividades cadastradas"
    },
    {
      element: "#nclients",
      title: "Clientes",
      content: "Esse é um contatos para todos os Clientes cadastrados"
    },
    {
      element: "#nprojects",
      title: "Projetos",
      content: "Contador para os Projetos"
    },
    {
      element: "#nemails",
      title: "Emails",
      placement: "left",
      content: "Contados para todos os Emails"
    },
    {
      element: "#lastclients",
      title: "Ultimos Clientes",
      content: "Os ultimos clientes adicionados"
    },
    {
      element: "#lastemails",
      title: "Ultimo Emails",
      placement: "left",
      content: "Ultimos emails trocados"
    },
    {
      element: "#lastprojects",
      title: "Projetos em Curso",
      content: "Ultimos projetos adicionados"
    },
    {
      element: "#lastactivities",
      title: "Atividades em Curso",
      placement: "left",
      content: "Ultimas atividades adicionadas"
    },
    {
      element: "#activitiescalendar",
      title: "Calendário de Atividades",
      content: "Seu calendário de atividades"
    },
    {
      element: "#gmailcalendar",
      title: "Calendário do Google",
      placement: "left",
      content: "Calendário importado do Google Calendar =D"
    },
    {
      element: "#lmenu",
      title: "Ações",
      content: "Na lateral temos os menus, nele você poderá ter acesso a todos os controles do CRM"
    },
    {
      element: "#lmenu",
      title: "Ações",
      content: "Por enquanto o menu Relatórios está ainda em construção"
    },
    {
      element: "#lmenu",
      title: "Ações",
      content: "Caso deseje ver o tour novamente basta acessar o menu Tour"
    },
    {
      element: "#lmenu",
      title: "Ações",
      content: "Por enquanto é isso, logo iremos fazer tour por todoas as páginas até o/"
    }
]});

tour.init();
tour.start();
tour.restart();

function getTourElement(tour){
    return tour._options.steps[tour._current].element
}
</script>